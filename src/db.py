import random
from collections import Counter
from typing import List

from Bio import SeqIO

# # used for translating a LEGO DNA sequence to the standard DNA sequence repr
# # e.g. sequence.translate(COLOUR_TO_BASE)
# COLOUR_TO_BASE = {
#     ord("B"): "T",
#     ord("G"): "A",
#     ord("Y"): "C",
#     ord("R"): "G",
# }
BASE_TO_SIGNAL = {
    "T": "2",
    "A": "3",
    "C": "4",
    "G": "5",
}

NUM_SENSOR_VALUES_PER_BASE = 44


def generate_vector_from_sequence(sequence: str) -> List[int]:
    sensor_values = []
    for base in sequence:
        if base not in BASE_TO_SIGNAL:
            continue
        sensor_values.extend([BASE_TO_SIGNAL[base]] * NUM_SENSOR_VALUES_PER_BASE)
    return sensor_values


def apply_errors(
    sequence: List[str],
    duplicate: float = 0.05,
    delete: float = 0.05,
    replace: float = 0.05,
):
    duplicate_at = []
    for index, value in enumerate(sequence):
        roll = random.random()
        if 0.0 <= roll <= delete:
            sequence[index] = "-"
        elif delete < roll <= delete + duplicate:
            duplicate_at.append(index)
        elif delete + duplicate < roll <= delete + duplicate + replace:
            sequence[index] = random.choice(["2", "3", "4", "5"])

    offset = 0
    for index in duplicate_at:
        sequence.insert(index, sequence[index + offset])
    return [*filter(lambda x: x != "-", sequence)]


# num of 10s in a row, we want to see to ltrim
K: int = NUM_SENSOR_VALUES_PER_BASE


def get_sensor_values_from_file(path: str) -> list[int]:
    import csv

    with open(path) as file:
        reader = csv.DictReader(file)
        values = [int(float(row["Colour_p4_01"])) for row in reader]

    # split in halves, trim both sides
    def ltrim(values):
        counter = Counter(values[-K:])
        # not foolproof but should work for our usecase
        for index in reversed(range(0, len(values) - K)):
            if counter[6] == K:
                return values[index + K + 1 :]
            counter[values[index + K]] -= 1
            counter[values[index]] += 1
        raise ValueError("unable to left trim white blocks from sequence of signals")

    # FIXME: niet altijd een goede schatting van de midpoint
    midpoint = len(values) // 2
    left_half, right_half = values[:midpoint], [*reversed(values[midpoint:])]
    trimmed_left_half, trimmed_right_half = ltrim(left_half), ltrim(right_half)
    return trimmed_left_half + [*reversed(trimmed_right_half)]


def init_db(db: list):
    for record in SeqIO.parse("data/extraAnimalBlastMetNamen.fasta", "fasta"):
        name, binomen = record.description.split("|")
        sequence = record.seq
        db.append(
            (name, binomen, sequence, "".join(generate_vector_from_sequence(sequence)))
        )


from rapidfuzz.distance import Levenshtein


def rank_matches(db: list, seq: str, scorer=Levenshtein.distance, is_score_inverted=True) -> list[tuple]:
    results = []
    for row in db:
        results.append((row, scorer(row[3], seq)))
    results.sort(key=lambda result: result[1], reverse=not is_score_inverted)
    return results


def find_closest_match(db: list, seq: str, scorer, is_score_inverted=True) -> tuple:
    return rank_matches(db, seq, scorer, is_score_inverted)[0]


MUTATED_SIGNALS = {
    # Key: binomen
    # values: signaal
    "Panthera tigris altaica": "4444444444444444444444444444444444444444444444544444444444445444444444444342244444444444444444444244444444444444444444444444444444444444444444444444444244444444444444333333232333333333333333333533333333333333333333333355554555535255555555555555552255555355555555555533233333333333333333233333333333343333333333333333222222222222223222222222322222222222222222222222222444444444444444444444444444444444444443444444444455444224444244444444444444444444444444444444444444444444444444444444444224444444444444444444444444444444444444444222222222222322222222222222223222222222222222255522222225523333333333333333333323333333333333333333333333333333333322222222222222222222222222222222223332222322222222222222223342222333333335333333333333533333553333333333333533333322222222222222222222222222252222222222222222222222222252222222222222222222222222222222222222222222222222222222433333333333333333333343333333333333333333333353333333353333325333333334333333333333433333333333333333322333333354444444344444444444444444444444444434444444444444244544444444444344443444444444344243333333333333353333333333333333333334333325555555552555555555555555555545555555555522223222224222222252225222222222222222222",
    "Sphaerias blanfordi": "444444442444444555544444444442444444444444444444444434444222222422222235225222552222222222222222222222222222444444444444444444443334444445433444443444444444444424433333353233333343333333343333333333333322333333333325555555555455555555555554455555555555555555545543333333333333333333333333332333334433323333333333222222222222222322233332222222222222224222222322222444444444444444444444444444444444444444444444454444444444444444444434454445443444444454444444444434444444444444444444443444444444444444424444444444444422222222222232222222222222222222222222222422222222222233333333343343343333343333333333323333333332233322222222222222222222222222222222222224222222232222222222233433333333333523323433335333433333333333333322222222222222222222222222422222222522222223222222225522222222225222222222222232222222222224222222222222222353333333333334333333333333233333333333333333333553333333333233333333333333333333233333333335333333333333444444444444444444444444444444444444424444444424444442324444444444444444444444424444444444445555555555552555252555555555555535525255553333333333233333333333335333323333333332222222222222222222222222232222222222222225",
    "Solanum lycopersicum": "55555555555555555555555555555355455555355555555544444444444444444444444444444444455454444444444344445222444444444444444444442434444444444444444443344444444433333333333333225333333333333334333333333333335555555555555554555525555555555555555555555555333555553333332333333333333333333333333333333333333333353322222222232232222222222222222222222233222252224444444344444444444444444444444444244444444444443444444434444444444444444444444444444444444444444444444444444244433444444444444444444444444444444444444444444442222222222224222222222222252222222222222222222333553333333333333343333333333333333333534233332222252222222222224223222222223222222222222222222222422233333333233333343333333333335333333333333533333332222222222222223222222255222222222422222222222223222222222222222222222222222222222222222222222222222222233343333333333333333333333552333325333333333333333333333333333333333333333335333333433333333333333333333333333333344444424444444234444444444443444444444444333332333333533333333333333333333333333333552555255553555555555555555545555355555555222233222222222222222222222222222222222223333243333333333333233333333333333323333233",
    "Solanum pennellii": "22222222222222552222222222222222422322222222222222222244444444444444444444444444444445544444442443434444443444444444444444444444444444444444443424444344444442444443333333355333333323223332333333333333333333333333333355555555555555455555555522225555522555355555555555555333333333222333333333333333333333333333433533333352222222222222222222322232222222522222222222222222222224433344444444444444444444444444444444444444444444454444444244444444444444444422244444444444444433444444444444224544444444445444433344444444444444444444432555522222222222222222222222222222222222222222222222222222222222333333333333333335533333333333333333333333333333222222222222222222222222222222222222242222222222222233333333333334333333332333333333332223333333333333333222225222222222222222222222222222222222522222222222222222442222222242222222222222222222222422222222222223233333433333333333333333333333332333554333333333333333333333333333333333543333333333333333333333333444444445444444444444444444444444444444444442255222222222222222222222222322222222222222554555555555555255555254555555555255355552222222224222222222222222222222542222222223553533333333333333333332333333333333",
    "Aedes albopictus": "33333333333333333333333333333333333333333333333325533333334224444444444444444444445444444444444444444444444444444444444444444444444444444444444444444444444444222222222232252222222222222222225222222242222522242222422222222222222252222222222222222222222222222222222555555555555555533555535555555555535525555555555552555534444445544444444444444433444444334444444444444444444444555535555555555555555555555555555555555544555555555533555222222222222222222252222522225242222222222222222222223333333333333333533333333333333333333333433333333333545525555555335555555555555555555555555544255555555555555555555555555555555555555555555555555555555555533333333333333333334333333333333333333333333323333333332222222442222222222222222222222222222225422222222222222322425555553555555555555555555255555355555555535555555555553333333433333333333333343323333333343333233334244444244444443444444324444444444444444444452555555555555555555553555555545555255255333333333233333333333233333333343333343222222222222522232322222222222224222222",
    "Marchantia polymorpha": "55555555555555455552555555555555555555555555555555555554444444424444444444444424444444444444444444444444445444444343322244444225544424444444444444444444454444444444422222222222222222222222222223322222232222222222223222222222222324422222222222222222242222222222222522222222255525555555555555555555555555555555555545555555555554344444444444434444224433444444444445444444444424444444444555555555555555555555555555555555555453555555255555555552242222222222223242222222222222322222222222222222223333333233333333333333333333333333333333333344333555555555555555555534455525555555555555555555555555555555555555525555555545555555344555555555225555555555533323333333323333333333333333333443333333333333323333333322222222222222222222222222222222222222222222222222255555555555355555255555255555555555555555335555333333333333333334355333333333333322333333333333354424444444444444444444444444444444444444354555555555555535555555535555555555554552333333333333333333333333334333333332333333333335333335333333433333333333333333333333",
    "Loxodonta cyclotis": "222222222255225222222222222222222222222222222232322555555554555555555555555555555555555555555555554445525555555555555555555555555455555553555555255555555355555555333333333333333333233333333333355333333335333333333333333333333333334333333333333333333333333333223333333332222222222222522222223222222322222222222222222222222333233333333333343333333333333333233333533333333333333333333333333333533333333333333323333333333333333333333333333333333333333333333333333333435533353333333333222223222222222222222222223352222225222522332222222244444444444424444444444544444444444444455442224444443355353333332333333333333333333333333333333532333333333343333333333355533333333333233333333332233333333333333335555553555555555555555555555532255555555555555555553333333333333333334333333333333333333533333333333333335555554455555555555555555555555555553445555555352222222222222222222222222222222222222222222222222223333333333333343333333333333333333333333333333333333333333333333335533333333333333333443333333333333333333335555554554553555555555355555555555555555555555553333333243333333333334343333333333333333333333333333333333322333333333332333333323333333333333333533323222222222242222222222422222222322224222225222222222222322222222222222222222222222222222424444444444444444444454444444444444444333332333333333333523333333433353333333344444444444444444444344444443444444444442",
    "Aldrovanda vesiculosa": "3333333233333333333333333333333333333334333333333333322222222222222222252222222222222224222222222222444222222222222244222222222222222222222222222222222222222222222225554555555555555555555555555355555555555555555555555555552555555555555555555555555555555555555522222222224222222522222223222222222222222222222233333333333333333333333333444333333533333333333335223333333333333333332333333333333333333333333333333333333333343533333333332332223333333333333332333333333333333333333333333333332222222222222222222222222253222223222222222222222222222222224444444444455444444254444444434444444444444444445544444333335333333333433333333333333233333333333333333333333333333333333333334433355333333433334333335555555555555555555555555555555555555555555555555555555555535533334433333333333333333433333333223433334335535333335555535555555555555555555555555555552255555555455222322222322222222222222222222322222222324422222333333333335333333333333333333333333553333333333333333333333333353333333333333333333333333333333235333333333333555555555533553335555555555555555555555555555225533333333333333333333333333333333444333333333333333333535443333533333333233333333333333333323343333332222222222222222222242222222222222222222222222222422222222222222222222222222222222222244434444444444434444344244444442444444444444444444444444444244434544444444444444333333333333533333333333333333333333332333",
    "Gossypium turneri": "22222232222222242222222222232222222222222252222222555555355555555555555555355555553554555555555553455555553555555555555555555555555555555555555555555555555555555533333333333333333333333333333333333333333333334333333335333333333333333233333333335333333333433333333333322222222222222222222222222222222222223222222555422333433333333433333333333333333333333533353333333333333333333333344333333333333333333333333333335553353333333333333333333333333333333433333333333333433333333333355333333333322222222222422222222222222222222222222222222222222222222224444224444444444444443344444444444444444424444444444433333333333333333333333333334333333333333333333333333333332333333333333333333333333333333333333333333335555555555555555555555355555555555555554555555555554333233333333333443333355333333333333333343333333332355355555555555555555555555553525555555555555555555355545555555555555255555554555555555555555525555555555555555555555555555555555555555545555555555555555553444444454444424434444444434554444444444444444444444444444333233433333333333333333333533333333333333333435223222222222322224224222442222223222222222222222222222224444444444444445524444444444444444444444443343333333333333333333333433333323333333333433353333333333333333333323323333333333333225222222222222224222222224222222222222244444444444444444444444444344444444444445443333333333433345333333333333334333333333",
    "Panthera leo": "33233343333333333333233333322233222333333333333333333333333343333333323333333333333222333333333533333333333333333333333332252222224222222222222222222523222222422222222522555525555554555555555555555555555555554555555555555555553333333233334333333333433343333334333333333333355344444444444444334444444444444444444444444444444444444444444443333323333333333333333333433333333333333333334443334334444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444544224444444433333333334333324333333344333332223333333333334333333225333333333333333333333333333333333332233333453333333333555555555555555555555522555555555555555525554535555555555555542244444444444444444444444444444444444444444444444344432232222222222222222222222222232222222222222222255555555555555555553353555555555555544555555555555552522224222222222222222555222222222222222222322224222222222222222222322222222222222222222222222255555555555555555555555555545555555554555523532222222222222222222222222222224222222444244444444444444444444444444444444444444444444444444434444444444544444444444443444",
    "Leuctra nigra": "3444444454444444444444444434444444444444444444444444555555555555555355555553355555555533355555552555555555522222242422222222222222222222322222522222222222445555555535555555555555555555555555555555555545555535555553332333333333333333333333333333333333333333323333233333333344444444444544444444444444444444444442444444444443344332533333333333333333333333333333333323333333333333333433333333333332333333333333333333533333333333334444444444444444444444444444444444444444433444444443323333333333333333333333333333333353333333333443555555555555555555555555554455555555554355555555555555444444554424442444444444444334444444444544445444244442222222222222222222222222222222222222222222222222222222222222252222222222222222225222222222224522222222222222222222225555555553555555555555555555555525555555555555555555555555555555555555555555555555555555555555555222222222322244222222222222222222222222222223222235555555555555555555555555555555555545525555222223222222222222222222222242222222222444444444444444444444424444444444444444444444525555555555554355555525555555555555525",
    "Vlupes vulpes": "33233333333223333333333343333333333333443333533333333333333333333353333333333333333333333333333333333333225555555555552255555225555555555555555555555555555455555555554244444444444224443444444444544444444434444544444444433333333333335333432333333333333333323323533333333535555555555555555555555555555555555555555555555555333333333333333334323333333333333334333333333333335322222222422222222222222222222222232222222222222444444444444444444443444444444445442244444444444442444444444444444442244444444444444444334422222222222255222222322222222222222222222222222222253233333333333333333333335333333343333333333333335555555555554555555545555545555552555555555555553353333333333333333233333333333333333353333333333333333334555355555555555555555555555555225555555555555555555554222444444222244444434444444444444444444444444224444244433333333333333333333333333333323333353333335555555534555555555555255555555555555555444444444444444444444444444444444244444433333333333333333333334333333333333333333",
    "Parus major minor": "555432555555555555555555555555555555355455555555555555555455555535555355555555555555555555555555555554533333333333333333333333355533335333334553333333333355555555555555555555555555555555552555555555555555255555555555555555255555555555555555555555544444444445444244442444444444455444444442234434444422222222222222222222222222222222222222233222222222422222222222322222222222222222222222252224222232222222222222232222233333333355335333533333333333333333333333333333333333333333332223333233333333333333333553333333333333344433333333343333333333333333433333333333344444444454444444444444444444444444444244444444444333333333353333333333333353333333333333333333333333333333333222222222222222222222222222222222222222222222244424222222222222222222222222222222222222252222222222222222222222222222222444444444444444444444444444444444444444444444444444444442444422222233222222222222222225522222222222222222442222225555555554553335555555555555355555523555555555522225222222222222222222222222222223222322255555555545555555555554555555555555555555522222222252222222222222225222222222222223255555555555555555555555555555555552555",
    "Meles meles": "22222222222223222222222522223222224222222222222225555355555555555225555355555355554555555555555555555555555555555555555555555555555555555555555555555552322252252222222222222222252222222222222222522222222222555555553555555555555555555555555555555555555555525444444444444444444444444444434444444244444444444444252224422222222222222222222222222222222222222322322222322222224422223222222222222222222222222332222222222333333553333232333333333333333333333333333322222222222222224422222322222222222222222222222224444444444444444444444444444444444444555444444445422222223222222222222522222222222222222522222522422255554555555555555555555555555555555555555555555555425533332553533333333333323333333433333333333333333333333333333355333333333333333333333355433233333333333344424444444444444443444444444444544444424444334445443333333335333333333355333333333333333333533333333333242232222233322223222222244224252222222222222222222555555555554555555555555555525555555555255333333333333334333333333333333333333333333545555555554522555555355555555355553555555555555552555555553555555555555553535555555555",
    "Oryctolagus cuniculus": "22224222222222222342222222222222222222222222222225233222552535555545544555555555555555555555555355554555555555444444444444444444444444444344424444443344444444444444444245544444544444444444444444444444444444444444222222222222222222222222222222222323222222222242222222222242222222222222222222223222222222222222222222222222222222222222222222222222252222222222222222422222222223333333333323333333333332333333333333333333333333333555555555555555555555555445225555555555555555525555555555355555555555555555555555553555255335555555554555555533333333343333333333353333333333333333333333333333333333222222222222222522222222222222222222222222222222222222222225222222223222222222222222222222222222222225555353555545555555555555555533555555555555555555555555555555555555555555555555553555555555555555545555555555222222223222225222222222222222222332222222222222222225444454444444444444444444444444444444445444444444444444222222222222222222222222222222222222222522224225222223333333333333333333333333333353533333333533333334333332222222222222222223444423222222222222222225222444444444444444444444434444454444444444425222222222422222222322222422224224222224444444454444444444444434444444442444444443422224222222222222222222222222222222222325555555525555555555355555355555555555555",
    "Bufo baturae": "45444444444444444444444444444444444454444444444444444444444444444444444244444444444434444444444444444444444444444444444444444444444444443444444444444444444444444444444445444444434444444444442224544444444444444444444445333333323333333333333333553333333333333533333333533333323332222222224422222222222223222222222222222222222222252222222222222555222233333333333333333333333333333333333333333333323333333333333333333333333432333333333333333333333333233333333444444444444444434444433554444444444222443444444444233333333333333333333433333335333333333333233333333333333333333333333333333333333333333333333333333333344333333333333333333335333333333333333333333333332324443333333333333344454444444434444444444444444444444444444434444444444444444422222222222222222222222222222222222222222222222222222233555535555555555555555555555355555555555555555555555544444444444444444444444444444444444444444345444444444424443222222242222222222322222224222222222222222555555555555555555555552554555555555555553334333333333332333332333333333333333333333222222222222222222222222222222222222222253333333333333333325333333433343323533333332",
    "Salamandra salamandra": "44444444444454442444444442442443344444444444444333332232333433332333333333333333333333333333333333344443444443444444444444444444444444244444444442444454455454553555222555555555555555555555555554555555555555555555533334333333533344333333333344333333333333333344444424444444444444444444543444424444444244444443323233333333353333333333333433333333333333333333343333333333333332333334333333333343333333353333333333333333333333333343333333333333333333333333333335335335333333333333333333333433333333333333333333333333334333333222222222222225222222222222222222222222222222222222333333344445533333334333333334333333333333333333333333333334444444444424444444444444454444444444444444444455444444444433333333333333333333333433322233553333333333333334223333433455555555335555555544554555555555555555555355523353433333333333333334333333333333333333333433555355555522555555555522555555555555555555555555553333335333333333333333333333333333344233333333333333334333355555555555255555555555555555555255555555553354555552424222222252222222222222222222222222322222222225555545555555555355255553555555555525554555555555555555555555555553555555555555523333333333333323333233432333343333333332222252222222222224222222222222222222222222333333333332333333332333333333333333333333",
    "Mycobacterium tuberculosis": "5555555555555255555455555555555555555555555555555555553333333333222333353333333333333333333333333333353333334424444444444424444444444443444444444444444444444444555555555555535555535555555555555455555555552222222222222222222222222222222222222222222222522222222222224224444444444444444444444344444444444445444443444444444444454444444444444444422444444444444444444445544443444444333333333333333333443322333333333333333333333333333335335555555555555555555555555555553355555555555555533333333333333333333333333333333333333333333333355233334444434444444444444444444444434444444444444444444444444444444444444444444444444444554444444424443444444444444424444555555555555555555555555555555555555555555555533555555533433335333333333333333333333333333233333343333333333322222222225222222222222222222222222222222222222222225222222222222252222222222225522222222322222222222222222222444444444344444443344444444444444444444444444444245555555555553555555555555555555555555545522222222224222222222232225222222222222222222222222222222222222222222222222222222222244434344444444424445444444444444444444444445555552355555555255525555552355555535555255",
    "Escherichia coli": "4444444444444443444444444444444444444444444444444444444444444442444444444244444444444443344444444434444333333333333333333333322233333333333333333333333553333333333333333333333333332333333333333333333333333333555555555555555552555555555555555555555555525534444444444444444444444444444444544443444454444445555552555555555455555555555455554555555555555555555553333333333333233443333333333333333333333333333333333333333333333333334333333333533333333334323333333333333333333335444444442444444444444444444444444344444444444444444444444444444444444444444444444445444444454444444444444445533235333335333333533333333333222233333333333333333333333333334323333333333333333333333333333333333333333333333333533333333333333433333333333333333333333333332222222222222222222222522222222222222222222222222222232333333333333333333333333433333332333333333355533333333333333333333322233333333333333533333334333332324333333233333333333233433533334333333333433353353333333333333333333333333333333333333333333333533343333335333335334333333343333333334333333333333333333333243333333533",
    "Carassius auratus": "4444444444444444433344444344442444442244544444444444443332223333343333333333333433333333223333443333333333555555555555555555532255555553335555555555553555552224222222225222222222222222222222422222222255555555553553555535555555555555555555555555555525444444444334425444444444444444444444444455444444444233222222222223222225222222222222322222224222222222225555555555555554555555552455555555555555555555555555555555255555555552555555552255555555535555555555555555555555555522222222222222222222222222222222222322255552222222222222224252223222222222222222222222222222222222222222222222222222222233333333333333333333333333333333233333533333333333333555555555555555525555555555555555355555555555255555444444444444444442244444444444444444444444444445444333333333233333333333333333333333333333333333333333333333333333333333333323343553333223333333333333333333533333333443333433333333333333333333334333354333222222222222222522222222222222222252222222555255555555555555555555535555555555555555444454444444444244444444444444445444424444",
    "Balaenoptera musculus": "2222222222222222222222222242222222222222222222222225554455555555555555555555555545555554555522555555555555555444444444434454444434444444454444444444444444444444333333333333335553333333322233333333333333333333333333322333333333333333333333333333333333333333333333333333333533333333333333333333333333333343333333333435555555555555555555555555535555555545555555555554255552222222222222222222222222222222222222222222222222255555555555555555555555555555555555555525555555555553333323333333333333333333233334333333333333333333555555555555555555555553355555555555555555555552255522554554553333333333323333333333222333333233333333323333333322222222222222522222222222222222222222222222222222353333353332353333353333333333333333333333333333333333333333333334333333333333333333334333333333333333333333555555555555555555555455555544335555535555355555244444444444444444444444444444444444444434444444444444555355555525555555555555555355555555555555555222222222222222222222222222225222222224222255555555545555255555255555555555555555555533333333333333333333333333333333333323333333",
    "Ananas comosus": "333333333333333333333333233333333333333333333333333333333333333333332222322222222222222222222222222222222222222222222222222233333333333333333333333333333333333333333333333333333333333553353333333333333333333333333333333333333333333533333333333333333333333333323333333333333333333333334333344445442222455444444444444444444444224444444444442222222222222522222222222222222222222222222222225522222222444444444444444444444444444444554444444444555442444442224222222222222222222222222222222222222222222222222222222233333333334333333333333333333333333333343333333333333333333333333533333333333333333333333333333333433343323333332222222222222222222222222222222222222222525222225222222222333333333333333333344323333333333333333333333333444444444444444444444222444434433444444444444444444444333333333333433333333533333434333333333333333333353353333344444444444342244444444444344444444444444444442224444444222222222222222222222232222222222222222222222222254222444444444444443444444444444424444444444444444444444544444444344444444444444444444544444444444444443344444444444442222222222222252222222222222222222222243444444544444444455444444544444444444444444444344244434444442445444444444444444444333333333333333333333433333333333332333333323333333333333333333533333343334323353333344444444444454444444444445434444444444444444",
    "Atriplex tatarica": "5555525555555535525455555555555545555555555555555555555555555555555555555335553555555555555555555555555555545555555555522222252222222223332222222522222232222222223322222233222255555555445555555535553555222255555535555555555555333535555222222222222222222222222222222222222222222222222442222222222222422222222244422222222222222222222222222222222222223353333333333333353333333333333333333333333333333333333444444444444444444444444444444443344444444444444444344444444444444444444244444444444444444444444444422222222222222222222222222222222222233242222432333353333333333333355333333333333333333333333333344444444444434444444444443344443444444244444444444444455555555544555555555555552525555555555555555455555555555444445244444444444544434444542442444444454444444444444442222222222222224222222222222222522222222222222222222522222222222225522242222222222442222222222222222222222222222222222222222222222222222222222222442222222222222244444444454444444444444424444443444444444432343333333333333333333333435333333334333222222222222222222222222222222222322222222222524222222222222522222222222222222222244444444244444444444444444244244444444444",
    "Spheniscus humboldti": "333333333333333333333323333333332333333333333333555555555555555255555555555555555555555555553555555542444444444444444444424443444444444454444445443443333333333333333333333333333333333353333333333333333333355555555555555555553535555555555555555555555555555255555333333333533333333333333333333333323333333333333333322222242222222222222224222222322222222222235222222222255555555555555555555555555555555555555555555555555555553552222222222232222242222222222422244222322222242222555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555542225555555552555555555555555555555555535555555555555555552555555555555555555555555555555555555555544455555533554555555555535555555555555555553555555255555555555555555555552222222222222222322222222222222222222222222222222232222252222222222222222222222222222222222222522222222555555555555554555555555555553555555555555552222222222322222222222224222222222222222233334335333333333333333333333333333333343355545355525535555555255555555554555554355",
    "Ursus americanus": "32222222222222222222222223222222222222222222322322222222222222232222224222222222222222232222222222222222222222222222224444444544444454444444455454444445554445444434444355444444444444444244444224444444444444444444444344544445444444444444444444444433444444444444444444444444444444442442444444444444444555344444444444442444445534444444422222232222222242222222222222222222252222223222444444444533444444444444444555444444444445444354444444444333333333333333333533323333433333333333333333333333333332332222222222222222222222224222222222222222222222222242222222222444444444444444244244444444444444444442244444444442555555555555533555535255355555555545555554553522555555555222222222222252222222222222222222222222222222222233333333333333343532233533333333333333333333333333333333333555555555555555555555555522545555555555555555555555522232222223222222222222222522222222222222222222222222222222222222222222522222222222222222222525555555225555555555555525555455555555555552222222222222222232222242222232222222222223333333333233333333333333333333335333333333",
    "Papilio machaon": "533333333333333333333233333333335333333333233333333333444244424444444444442444444444444444422444444443444442222222222222222422222222222222222222222222232222222444222222222224422222222222222222332222222222222255555545555555555555555555555555555555555555255222222222222222222222222222222222222233222222222222223334533334444553333333333355333333333333333333333333333333335533333333333333333333333333333333333333333333333344333333333322323533333333333333333333333333555333222222222222222222223322222222222352442222332222225555255555553525555555555555555555555555555555552255555522222222222322242222242222242222222222222222222225555555555555555555225525555555555555555555545555555555524333333343333333333333333333333333333333333333333232222222222222232222222222222222522222224222222222222233333333333333333333333335333333323333333333333333333222222252222222222524222222222223232222222322222225222222222222222222222222222222222222222222242222222222242222222322222223422323333333333333333333334333333333333223333322222222222222322222222222222222222222222",
    "Chelonia midas": "454444444444444442244444444444444444443424444444444444333335333334333233333333433332333333333333333333353333333333333333333333333333333334332333333333333332222242222222322222522222222522224222222222222223333333333333333333333333333333333333333333333444444444444444444444444444244444444444545444444444333333333333333333333333333323353333344333333333332233334444544444444444443333442444444444444444444442444444444444422222222522222222222222222222242222222222222222222222222222222233333333333333333333333333335333333333333333333333333333444444444444444444444444444244444444444444444444444255222222232232222222222222222222222222222532222222242444444544444444444444444224454444444444444444444442353333333333333353333333353333333333333333333333324444444443424444444444444424444454444443444444444244444444445444444444444444444442444444445444444444444444444443333333333333533533333333343333333333332333433333333455555555555555555555555555555555555455555555553433333352333333333333333333333333333333333333333553233344444444444444434444444444444444444444444444444444444433333333333333433333333333333333333222333333333333333433222222222222222222232222222222222222222222222222222244444444444444444435444444344444444444454344444444444222422244222222222222222222322223252222222244444444444444244444244443444444444242444444444444434444444444344444444444444444444444333333333343533333323333333333333333533252222522222242222225222222322222222222233333333333333432333333333333333333333333",
    "Ordo crocodilia": "2444444444444424444444444444444444444444444444444444444333333333333333333333323333333333333333333333333333333333333343333322343333333333333333333333335333333323333333333333333333533333333333343333333333333333333333333233333333322333333333333333353333333333333333444444444444434244444444444454444444444444455233333333333333332233333333333223333333333353333333333333333333233333333333333333333333333333335533333333333355555555555555555555545555555555555355555525555533343355553333333333333333333333333333333333334333333333333333555555555333555555555555555535555555555555555555523555553355555555555555455555555555555555555555555555555555555555555555555544444444444444444444444444444444444444424444444444444444444444444444444444444444444444444244224442222222222222222222223332222222222222222222222222222233333333333333433333333333533333333333333332222522232222222222523222222225222222222232224222222233222222222222222222222222222222233543333333333333333333333333333333533333",
    "Pygocentrus nattereri": "33333333533344333322333333333533333333333333333335333344444444444444444444444424444444444444444444444444443333333333333353335333333333333333333333433333333322433222442222232222222222222222222222222222222222222222222222255222222222222242222222222222222222222222222222222222222222222222222222222322222422222222242222222222222222444444333444444455433344444444444444444444444433424444444444444444444444442444454424442444444444444443222233222222222222222222224222222222224222222222222223444444444444444344443344444444443444444444444444443333333333333333233333333433333343333333333333333333334424444454444444444444442444444444444444444444444222222222222222222225225222222222222222224222253333333333333333333333333333233333333333333333333333333344322333333333333333333333333223333333323333333333333444444444444444444224444344444444444444334444444444344544444424444444443424444444444444444444444443333332333333333332333333335333333333333333333333333333333333333333333333333333333333444444444444444444444444454444444444444444",
    "Lumbricus terrestris": "555555555335555555555555555555555535555555555555555555455444444444444444444444444444444444444444444444444443444444442244444444444444444444455544444444444444244444444555555555555555555555555555555555555552555555525555555535555555555555555555545555255555555554445555532533333333333333333333333333333333333333332333333335555355555555555535235555555555555255555555555554444444334444444444444444444444544444544422444445555555555555555555555555545555555555555555553555555554522222222222422222255222222222222222222222222222222222222222222222222222222222222222222222222222255523222222233333333333333333333333333353233333335333333333333333335355555555555555555555555555555555555555555555555555555535555555555555555555555555555555552555555555533333333333333333333322333333333333333333333333555554555555555255555555555555555555555555555555555555435444424444444444425544444444445444444444444444444255335555555555555555555552545555555555225555455553333333333334333333333333333333335333333353222222222222222242222222222222222222222222233333333323333333333433333333333433323335555555555245555555555453554555555555555",
    "Enterococcus avium": "555555555555255555255355555552555555555555552555554555555555555555555555555555555555555555555555544555544554442444444422244444445222444444444444444444444444444445522255555555555555555552525355555525555555555555555555555455555522555555555555555555555555555555555555524555533333333333333333333333333333333333333333333333333355555555555555555555535555555555555555555555555555255555555454444444444444454544444444444444444444444444444444444555555555555555555555555555555555555555555555555555555555555222222422222222222225522532222222222422222222224225522222222222222222222222222222222222224222222224433255222333343333333333333333333333333333333333353433333333335555555543352222555525555555555555555555555555555555555525555555555555555555455555555555555555555555555443333333333333543333333333333333333333333335333335555525555555555555555555552555555555555555555554524444444444445434444444444444444444444444444443444445452555555555555555555555555553255535554555333233333333333333333333333323333333333333522222222222224222222222222222222422222222555555255555545255555555555555355555555533333353323333333333335533333332333333333",
    "Candidatus_Giovannonibacteria": "55235545555555555555555555555555455555555555555555244334444444444444444444444444434224444444444444444443444444444444444444444444444444224444444444444444444444444444555555555552555555555555555555552555554555555555555555555555555555555555555555555555555555555555455353333333333333333333233333333333333333333333353333552535552255555555533555555555555555522555555555552222555554444444444444444444444244444444444444424444444442244444444555535555555542555555555555555555555554455555555544522222225555222222253222222222222222222222222222224222222444222222222222222222222222222222222222222222222222222333333334333333333333333333335333333333443333333355555555555555555555555555552555555555555553522555545555555555225555552555255555555555555555555555555555535333333333333333333333333333333333533333333335333533333333355555555555555555555554555555555555555555555555222222222225222222442222222222322222222222222222222222222222222222222222422222222222222222222225555555555555555555555555555555555555555252333333335333333533333333333333233343333355333333533353233333335433333433333333333335555555555455555455555555555555555555555",
    "Amanita muscaria": "5224222224222332222222244422222222222222222222222222233222222322222224222222222222222222222222222222222222222223225554555535555555555555555555555555555555555555555555522554222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222244434444444444444444445444444444444444244444444435333333333333333333433333344333333333333333333333333355555555445555555555554555555555335555555555555555555545555455555555555555555555555555555555555555555255555544444444444444444444443444444444444444444444444444444432222222222222222222242222225233322222222222222225522555555555555555225555555555555555555555555555545555555555555552222222222222222222224322222222222232222222222224422222244444444444444444444444444444444444444445422222222222222222222222352222222222222322233333333332333333333333333333333333333333333222322224222222222222222222253222222223222",
    "Physalia physalis": "33355533323333333333333333333332333443333333333432233322222222222222222222242522222422222222222222222222234444444444433444444444444544444444444444444433333333333333333533334333333233333333333333433433334444444444444422444444444444444444444444444444444444442444444444444444444434444444444444443544444444444444522222222222222222222222222222224222222222222222222222222222222222222242224222222223332224333222222222222222222222222222222223222222222222222222225222322222222333333333333333333333333333335335333333333333333322222222222422222222222233222555333222222233222222222222222222233333333333333333333333433233333333333333333333333333333332223323333333333333323333333333333333333333332333333333233222222222222222222222222552222222222222222222222222555335555555555555455555555555555555555555552555555555555222222222222222222222222222322222222222222222222222222222222222222222222222244222222222224222222222222225222222233333333333322322433333333333333333335553533333322222222222245222222222222224224222222225333333333333333333333333333533333333333335355355525555555555555555555555555555535555222222222222222222222222222222252232222222333533333333333333333333333333333234333333",
    "Luperina testacea": "5555522555555555555555555555555555555555555555333333353333222333333333333333333334333333335333333333333333333333333433343333333333333333333333322433333333333333333333433333343322333333333333333333333333333353444444444444444444444444444445444444444444444444444444444444444445544444444444444444444444444444444444444422222222322222222222222222222522222222222222222222222222222222225224422222222222222222224422222222222222222222222222222222222222222222222222222222222333223333333333334333333333333332333334333333333222222222242222222222222222422222222222222222222222222533333333343333333333333333233333333333333333333333333333333333333343333333333333333333333333533333333333333333222222222222222222223255222322555522222222222222222222552555445522555555555552555555555555555555555555555555222222522552222222222222222222222225222222223222222222222223222222243333222222222222222222222422222223332333333333333333333333333333333333333353443333333334422222222222352222222222222222222225224223222522522233222422522222222232222222222242224324444454444454444444444444444444442433353333343333353333333335332333433333333333333253333333233333332333333333333333333",
    "Danio aesculapii": "5555555555555555555555545555555455555555555555555555225222222522222222222222222222224222222224222222222222333333333333333333333333333335333433333333333333333355555555555555555555555555355554555555555555555555523322322222222442425522222222222522222222222222222222333333333333333335333333333333333353333332333333335432223222222222223222222222222222222522422222222222224222222222222222222222222522222222222222322222222223332222223222222222222222222222222222222222222222222222222223233333333332333333233333333333333333244333222222222225522222222222222222422222242222222222222222222423333333333333333333333333333333333333333333333533333333333333333533333444332223334233333333322333333333323335335332222222222222222222222422222222223222222222222222222225555555555555554555555533355555555555355555555555555555524422222222222222225522222222252222222222222222222222222222522222222222222222222522222422222222232223333333333333333334333333333333333333233333333333355222222222224222222222222232224222222322243333333333333333333333333334333333335333333555555355555355555553535555355555555555555222222223222222222222222222222222222232522223333333333333333333333333333323343333333333",
    "Malachius bipustulatus": "5555555555552535555555555555555555444555555545553333333343333333333333333323333333333333333333333335543333333355533333333433333333323333333333333333333333333333333334333343344333333333334353333333333333333325333333343544444444244444444444444443334444444444444444445444444444444242444344444444444444444444442444442222242222222244222222222222222222222222222222222222222222222222222222222222222222222225222222222222222222222322222255522223222222222232232222222222225523333333335333233333223333333333333333333353233333332222222222222222222222222222222232222222222222222222222333333333333333333333333333333323333333333333333335533333333355323333333333333333333333353333333333333333333333333333333222222222222252222522222223225222422222222222222222555555555555555555555555555555555555555555555555555222222222222222222222222222222222222222222252222222222222222222222222222222222222242222522222222222522333333333333333333343333243333343333333333553333343333333332222222252322222422222242222222222222222222223323333333333353333333333333334343333555555555555555555555555525555555555555552555555525245555555555555555554555555555555222223222222522222222222222222222222222222",
}

if __name__ == "__main__":

    db = []
    init_db(db)
    # print(db)

    # tiger_signal_sequence = db[0][3]
    # print(tiger_signal_sequence)
    # mutated_sequence = "".join(
    #     apply_errors(
    #         list(tiger_signal_sequence), duplicate=0.22, replace=0.10, delete=0.05
    #     )
    # )
    # print(mutated_sequence)
    # matches = rank_matches(db, mutated_sequence)
    #
    # for row in db:
    #     print(
    #         f'"{row[1]}": "{"".join(apply_errors(list(row[3]), duplicate=0.22, replace=0.10, delete=0.05))}"'
    #     )
    # # print(matches)
    # print([(match[1], match[0][0]) for match in matches])
    # # print(Levenshtein.similarity(tiger_signal_sequence, mutated_sequence))
    # # print(Levenshtein.distance(tiger_signal_sequence, mutated_sequence))
    # # print(f"{len(tiger_signal_sequence)} vs. {len(mutated_sequence)}")

    for sequence_index in range(1, 8):
        for reading_index in range(1, 4):
            unindentified_seq = "".join(
                [
                    str(val)
                    for val in get_sensor_values_from_file(
                        f"data/{sequence_index}_{reading_index}.csv"
                    )
                ]
            )

            matches = rank_matches(db, unindentified_seq, scorer=Levenshtein.distance)[
                :3
            ]
            print([(match[1], match[0][0]) for match in matches])
        print()
